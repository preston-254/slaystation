<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slay Station - Couch Bags & More | Shop Now</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Leaflet.js for map picker -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <h1>‚ú® Slay Station ‚ú®</h1>
            </div>
            <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="nav-menu" id="navMenu">
                <li><a href="index.html#home">Home</a></li>
                <li><a href="index.html#products">Bags</a></li>
                <li><a href="wallets.html">Wallets</a></li>
                <li><a href="accessories.html">Accessories</a></li>
                <li><a href="index.html#slayworld">SlayWorld</a></li>
                <li><a href="index.html#about">About</a></li>
                <li><a href="index.html#contact">Contact</a></li>
            </ul>
            <div class="nav-actions">
                <div id="userInfo" class="user-info" style="display: none;">
                    <!-- User info will be populated here -->
                </div>
                <a href="login.html" id="loginBtn" class="nav-btn-round nav-btn-login">Login</a>
                <a href="signup.html" id="signupBtn" class="nav-btn-round nav-btn-signup">Sign Up</a>
                <button id="logoutBtn" onclick="logout()" class="nav-btn-round nav-btn-logout" style="display: none;">Logout</button>
                <div class="nav-btn-round nav-btn-wishlist" onclick="toggleWishlist()" title="Wishlist">
                    üíñ <span class="nav-badge" id="wishlistCount">0</span>
                </div>
                <div class="nav-btn-round nav-btn-cart" onclick="toggleCart()" title="Cart">
                    üõçÔ∏è <span class="nav-badge" id="cartCount">0</span>
                </div>
                <div class="nav-btn-round nav-btn-notifications" onclick="showNotificationsPanel()" title="Notifications" id="notificationBtn" style="display: none;">
                    üîî <span class="nav-badge" id="notificationBadge" style="display: none;">0</span>
                </div>
            </div>
    </nav>

    <!-- Flash Sale Banner -->
    <div class="flash-sale-banner" id="flashSaleBanner">
        <div class="flash-sale-content">
            <span class="sale-icon">üéâ</span>
            <span class="sale-text">FLASH SALE! Up to 30% OFF selected items! Limited time only!</span>
            <span class="sale-icon">‚ú®</span>
            <button class="close-sale" id="closeFlashSaleBtn" type="button">‚úï</button>
        </div>
    </div>

    <!-- Hero Section -->
    <section id="home" class="hero">
        <div class="hero-content">
            <h1 class="hero-title">Couch Bags That Slay! üíÖ</h1>
            <p class="hero-subtitle">Discover the trendiest bags for every occasion. Style meets comfort!</p>
            <a href="#products" class="cta-button">Shop Now</a>
        </div>
        <div class="hero-decoration">
            <div class="floating-shape shape-1"></div>
            <div class="floating-shape shape-2"></div>
            <div class="floating-shape shape-3"></div>
        </div>
        <!-- Hero Video Background (Optional - only shows if video exists) -->
        <div class="hero-video-container" id="heroVideoContainer" style="display: none;">
            <video class="hero-video" autoplay muted loop playsinline preload="none">
                <source src="videos/hero-bg.mp4" type="video/mp4">
                <source src="videos/hero-bg.webm" type="video/webm">
            </video>
            <div class="hero-video-overlay"></div>
        </div>
    </section>

    <!-- Products Section -->
    <section id="products" class="products-section">
        <div class="container">
            <h2 class="section-title">Our Bag Collection</h2>
            <p class="section-subtitle">Choose your perfect slay! ‚ú®</p>
            
            <!-- Search and Filter -->
            <div class="search-filter-bar">
                <div class="search-box">
                    <input type="text" id="productSearch" placeholder="üîç Search bags..." class="search-input">
                    <button class="search-btn" onclick="searchProducts()">Search</button>
                </div>
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="filterProducts('all')">All</button>
                    <button class="filter-btn" onclick="filterProducts('couch-bag')">Couch Bags</button>
                    <button class="filter-btn" onclick="filterProducts('tote-bag')">Tote Bags</button>
                    <button class="filter-btn" onclick="filterProducts('sale')">On Sale</button>
                    <button class="filter-btn" onclick="filterProducts('new')">New</button>
                </div>
            </div>
            
            <div style="text-align: center; margin-bottom: 2rem; margin-top: 2rem;">
                <a href="wallets.html" class="category-link">View Wallets üëõ</a>
                <a href="accessories.html" class="category-link">View Accessories üéÄ</a>
            </div>
            <div class="products-grid" id="productsGrid">
                <!-- Products will be dynamically added here -->
            </div>
        </div>
    </section>


    <!-- SlayWorld Section -->
    <section id="slayworld" class="slayworld-section">
        <div class="container">
            <h2 class="section-title">‚ú® SlayWorld ‚ú®</h2>
            <p class="section-subtitle">Connect with friends, share your favorites, and discover what's trending! üíñ</p>
            
            <div class="slayworld-tabs">
                <button class="slayworld-tab active" onclick="switchSlayWorldTab('shared', this)">üì§ Shared with Me</button>
                <button class="slayworld-tab" onclick="switchSlayWorldTab('trending', this)">üî• Trending</button>
                <button class="slayworld-tab" onclick="switchSlayWorldTab('friends', this)">üë• My Friends</button>
            </div>
            
            <div id="sharedTab" class="slayworld-tab-content active">
                <div id="sharedContent" class="slayworld-content">
                    <!-- Shared items will be displayed here -->
                </div>
            </div>
            
            <div id="trendingTab" class="slayworld-tab-content">
                <div id="trendingContent" class="slayworld-content">
                    <!-- Trending items will be displayed here -->
                </div>
            </div>
            
            <div id="friendsTab" class="slayworld-tab-content">
                <div id="friendsContent" class="slayworld-content">
                    <!-- Friends list will be displayed here -->
                </div>
            </div>
        </div>
    </section>

    <!-- Video Section -->
    <section class="video-section">
        <div class="container">
            <h2 class="section-title">Watch Our Collection Come to Life! üé¨</h2>
            <p class="section-subtitle">See our bags in action and get styling inspiration! ‚ú®</p>
            
            <div class="video-grid" id="videoGrid">
                <!-- Videos will be dynamically added if they exist -->
            </div>
            <div id="videoPlaceholder" style="text-align: center; padding: 3rem; color: #666;">
                <p style="font-size: 1.2rem; margin-bottom: 1rem;">üé¨ Videos coming soon!</p>
                <p>Add your product videos to the videos folder to see them here!</p>
            </div>
        </div>
    </section>

    <!-- Testimonials Section -->
    <section class="testimonials-section">
        <div class="container">
            <h2 class="section-title">What Our Customers Say üí¨</h2>
            <p class="section-subtitle">Real reviews from real customers!</p>
            
            <div class="testimonials-grid" id="testimonialsGrid">
                <!-- Testimonials will be dynamically added here -->
            </div>
        </div>
    </section>

    <!-- Newsletter Section -->
    <section class="newsletter-section">
        <div class="container">
            <div class="newsletter-content">
                <h2>Stay in the Loop! üíå</h2>
                <p>Subscribe to our newsletter for exclusive deals, new arrivals, and styling tips!</p>
                <form class="newsletter-form" id="newsletterForm" onsubmit="subscribeNewsletter(event)">
                    <input type="email" id="newsletterEmail" placeholder="Enter your email address" required>
                    <button type="submit" class="newsletter-btn">Subscribe ‚ú®</button>
                </form>
            </div>
        </div>
    </section>

    <!-- FAQ Section -->
    <section class="faq-section">
        <div class="container">
            <h2 class="section-title">Frequently Asked Questions ‚ùì</h2>
            <div class="faq-container">
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>What is the delivery time?</span>
                        <span class="faq-icon">‚ûï</span>
                    </div>
                    <div class="faq-answer">
                        <p>We typically deliver within 2-5 business days after order confirmation. You can track your order in real-time once it's dispatched!</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>What payment methods do you accept?</span>
                        <span class="faq-icon">‚ûï</span>
                    </div>
                    <div class="faq-answer">
                        <p>We accept M-Pesa, Credit/Debit Cards, and Cash on Delivery for your convenience!</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>Can I return or exchange items?</span>
                        <span class="faq-icon">‚ûï</span>
                    </div>
                    <div class="faq-answer">
                        <p>Yes! We offer a 7-day return policy for unused items in original packaging. Contact us for exchange or return!</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>How do I earn points?</span>
                        <span class="faq-icon">‚ûï</span>
                    </div>
                    <div class="faq-answer">
                        <p>You earn 1 point for every 100 KSH spent! Sign up now and get 100 welcome points. Points can be redeemed for discounts!</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>Do you offer gift wrapping?</span>
                        <span class="faq-icon">‚ûï</span>
                    </div>
                    <div class="faq-answer">
                        <p>Yes! Add gift wrapping for just KSH 150 during checkout. Perfect for special occasions! üéÄ</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="about-section">
        <div class="container">
            <div class="about-content">
                <h2>About Slay Station</h2>
                <p>We're all about bringing you the most stylish and comfortable bags that make every outfit pop! From cozy couch bags to trendy tote bags, we've got everything you need to slay your look.</p>
                <div class="features">
                    <div class="feature">
                        <div class="feature-icon">üíù</div>
                        <h3>Premium Quality</h3>
                        <p>Handpicked materials for durability and style</p>
                    </div>
                    <div class="feature">
                        <div class="feature-icon">üöö</div>
                        <h3>Fast Delivery</h3>
                        <p>Quick shipping to get your bags ASAP</p>
                    </div>
                    <div class="feature">
                        <div class="feature-icon">üí≥</div>
                        <h3>Easy Payment</h3>
                        <p>Secure and hassle-free checkout</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Shopping Cart -->
    <div class="cart-overlay" id="cartOverlay">
        <div class="cart-sidebar">
            <div class="cart-header">
                <h2>Your Cart üõçÔ∏è</h2>
                <button class="close-cart" onclick="toggleCart()">‚úï</button>
            </div>
            <div class="cart-items" id="cartItems">
                <p class="empty-cart">Your cart is empty. Start shopping!</p>
            </div>
            <div class="cart-footer">
                <div class="delivery-fee-info">
                    <small>üì¶ Delivery fee will be paid separately (KSH 200)</small>
                </div>
                <div class="cart-total">
                    <strong>Total: KSH <span id="cartTotal">0</span></strong>
                </div>
                <button class="checkout-btn" onclick="checkout()">Checkout</button>
            </div>
        </div>
    </div>

    <!-- Order Form Modal -->
    <div class="modal-overlay" id="orderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Complete Your Order ‚ú®</h2>
                <button class="close-modal" onclick="closeOrderModal()">‚úï</button>
            </div>
            <form id="orderForm" class="order-form">
                <div class="form-group">
                    <label for="mpesaPhone">M-Pesa Phone Number <span style="color: #dc3545;">*</span></label>
                    <input type="tel" id="mpesaPhone" name="mpesaPhone" required placeholder="e.g., 0712345678" pattern="[0-9]{9,10}" maxlength="10" inputmode="numeric">
                    <small style="color: #666; font-size: 0.85rem; display: block; margin-top: 0.25rem;">
                        Enter the phone number registered with M-Pesa (start with 0, e.g., 0712345678)
                    </small>
                </div>
                <div class="form-group">
                    <label for="name">Full Name</label>
                    <input type="text" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="phone">Contact Phone Number</label>
                    <input type="tel" id="phone" name="phone" required placeholder="For delivery updates">
                </div>
                <div class="form-group">
                    <label for="address">Delivery Address</label>
                    <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <button type="button" id="useMapPickerBtn" onclick="toggleMapPicker()" style="padding: 0.5rem 1rem; background: linear-gradient(135deg, #2196F3, #1976D2); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.9rem; white-space: nowrap;">
                            üìç Pin Location on Map
                        </button>
                        <button type="button" id="useTextAddressBtn" onclick="toggleMapPicker()" style="padding: 0.5rem 1rem; background: linear-gradient(135deg, #666, #555); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.9rem; white-space: nowrap; display: none;">
                            ‚úèÔ∏è Enter Address Manually
                        </button>
                    </div>
                    <!-- Map Picker -->
                    <div id="mapPickerContainer" style="display: none; margin-bottom: 0.75rem;">
                        <div id="mapPicker" style="height: 300px; width: 100%; border-radius: 10px; border: 2px solid #ddd; z-index: 1000;"></div>
                        <div style="margin-top: 0.5rem; padding: 0.75rem; background: #E3F2FD; border-radius: 8px; font-size: 0.85rem; color: #1976D2;">
                            <strong>üìç Instructions:</strong> Click on the map to pin your delivery location. The address will be automatically filled.
                        </div>
                    </div>
                    <textarea id="address" name="address" rows="3" required placeholder="Enter your delivery address (e.g., Westlands, Nairobi) or click 'Pin Location on Map' to select on map"></textarea>
                    <!-- Real-time Delivery Fee Display -->
                    <div id="deliveryFeeDisplay" style="margin-top: 0.75rem; padding: 1rem; background: linear-gradient(135deg, #E3F2FD, #BBDEFB); border-radius: 10px; border-left: 4px solid #2196F3; display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #1976D2; margin-bottom: 0.25rem;">
                                    üìç Estimated Delivery Fee
                                </div>
                                <div id="deliveryFeeDetails" style="font-size: 0.85rem; color: #666;">
                                    Calculating...
                                </div>
                            </div>
                            <div id="deliveryFeeAmount" style="font-size: 1.5rem; font-weight: bold; color: #1976D2;">
                                KSH 0
                            </div>
                        </div>
                        <div id="deliveryFeeDistance" style="margin-top: 0.5rem; font-size: 0.8rem; color: #666; font-style: italic;">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="payment">Payment Method</label>
                    <select id="payment" name="payment" required onchange="handlePaymentMethodChange(this.value)">
                        <option value="">Select payment method</option>
                        <option value="mpesa">M-Pesa</option>
                        <option value="card">Credit/Debit Card</option>
                        <option value="cash">Cash on Delivery</option>
                    </select>
                </div>
                
                <!-- M-Pesa Payment Section -->
                <div id="mpesaPaymentSection" class="mpesa-payment-section" style="display: none;">
                    <div class="mpesa-phone-prompt" style="background: linear-gradient(135deg, #4CAF50, #45a049); color: white; padding: 1.5rem; border-radius: 15px; margin-bottom: 1.5rem; text-align: center; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3); animation: pulse 2s infinite;">
                        <div style="font-size: 3rem; margin-bottom: 0.5rem;">üì±</div>
                        <h3 style="margin: 0 0 0.5rem 0; font-size: 1.3rem;">Complete Payment on Your Phone</h3>
                        <p style="margin: 0; font-size: 1rem; opacity: 0.95;">Please use your phone to complete the M-Pesa payment now</p>
                    </div>
                    
                    <div style="background: #E8F5E9; padding: 1rem; border-radius: 10px; margin-top: 1rem; border-left: 4px solid #4CAF50;">
                        <p style="margin: 0; color: #2e7d32; font-weight: 600; font-size: 0.95rem;">üí° M-Pesa Payment:</p>
                        <p style="margin: 0.5rem 0 0 0; color: #555; font-size: 0.9rem; line-height: 1.5;">
                            When you click "Place Order", you will receive an <strong>M-Pesa payment request on your phone</strong>. Enter your M-Pesa PIN to complete the payment.
                        </p>
                    </div>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="giftWrap" name="giftWrap" style="width: auto; margin-right: 0.5rem;" onchange="updateOrderSummary()">
                        Add Gift Wrapping (KSH 150) üéÄ
                    </label>
                </div>
                <div class="order-summary">
                    <h3>Order Summary</h3>
                    <div id="orderSummary"></div>
                </div>
                <button type="submit" class="submit-order-btn" id="placeOrderBtn">Place Order üéâ</button>
            </form>
        </div>
    </div>

    <!-- M-Pesa STK Push Modal -->
    <div class="modal-overlay" id="stkPushModal" style="z-index: 5000;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>üì± M-Pesa Payment</h2>
                <button class="close-modal" onclick="closeStkPushModal()">‚úï</button>
            </div>
            <div style="padding: 2rem;">
                <!-- Phone Prompt -->
                <div id="stkPhonePrompt" style="text-align: center;">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">üì±</div>
                    <h3 style="margin-bottom: 1rem; color: #1976D2;">Check Your Phone!</h3>
                    <p style="color: #666; margin-bottom: 1.5rem; line-height: 1.6;">
                        An M-Pesa payment request has been sent to:<br>
                        <strong style="font-size: 1.1rem; color: #1976D2;" id="stkPhoneNumber">Your Phone</strong><br><br>
                        <strong>Please check your phone and enter your M-Pesa PIN</strong> to complete the payment.
                    </p>
                    <div style="background: #E3F2FD; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem;">
                        <div style="font-size: 1.2rem; font-weight: 600; color: #1976D2; margin-bottom: 0.5rem;">
                            Amount: <span id="stkAmount">KSH 0</span>
                        </div>
                        <div style="font-size: 0.9rem; color: #666;">
                            Paybill: <strong>516600</strong> | Account: <strong>944444</strong>
                        </div>
                    </div>
                    <button onclick="proceedToPinEntry()" class="submit-order-btn" style="width: 100%;">
                        I've Entered My PIN ‚úÖ
                    </button>
                    <button onclick="closeStkPushModal()" style="width: 100%; margin-top: 0.5rem; padding: 0.75rem; background: #f5f5f5; border: none; border-radius: 8px; cursor: pointer; color: #666;">
                        Cancel Payment
                    </button>
                </div>

                <!-- PIN Entry -->
                <div id="stkPinEntry" style="display: none;">
                    <div style="text-align: center; margin-bottom: 1.5rem;">
                        <div style="font-size: 3rem; margin-bottom: 0.5rem;">üîí</div>
                        <h3 style="margin-bottom: 0.5rem;">Enter M-Pesa PIN</h3>
                        <p style="color: #666; font-size: 0.9rem;">Enter your 4-digit M-Pesa PIN</p>
                    </div>
                    <div class="form-group">
                        <input type="password" id="mpesaPinInput" maxlength="4" pattern="[0-9]{4}" placeholder="Enter 4-digit PIN" style="text-align: center; font-size: 1.5rem; letter-spacing: 0.5rem; font-weight: 600;">
                        <small style="color: #666; display: block; margin-top: 0.5rem; text-align: center;">
                            Your PIN is secure and encrypted
                        </small>
                    </div>
                    <div style="display: flex; gap: 0.5rem; margin-top: 1.5rem;">
                        <button onclick="goBackToPhonePrompt()" style="flex: 1; padding: 0.75rem; background: #f5f5f5; border: none; border-radius: 8px; cursor: pointer; color: #666;">
                            ‚Üê Back
                        </button>
                        <button onclick="confirmMpesaPayment()" class="submit-order-btn" style="flex: 2;">
                            Confirm Payment üí≥
                        </button>
                    </div>
                </div>

                <!-- Processing -->
                <div id="stkProcessing" style="display: none; text-align: center;">
                    <div style="font-size: 4rem; margin-bottom: 1rem; animation: spin 1s linear infinite;">‚è≥</div>
                    <h3 style="margin-bottom: 0.5rem;">Processing Payment...</h3>
                    <p style="color: #666;">Please wait while we confirm your payment</p>
                </div>

                <!-- Success -->
                <div id="stkSuccess" style="display: none; text-align: center;">
                    <div style="font-size: 4rem; margin-bottom: 1rem; color: #4CAF50;">‚úÖ</div>
                    <h3 style="margin-bottom: 0.5rem; color: #4CAF50;">Payment Successful!</h3>
                    <p style="color: #666; margin-bottom: 1rem;">Your order has been saved and is being processed</p>
                    <div style="background: #E8F5E9; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <div style="font-size: 0.9rem; color: #2e7d32;">
                            Confirmation Code: <strong id="stkConfirmationCode" style="font-family: monospace; font-size: 1.1rem;">ABC123XYZ</strong>
                        </div>
                    </div>
                </div>

                <!-- Failure -->
                <div id="stkFailed" style="display: none; text-align: center;">
                    <div style="font-size: 4rem; margin-bottom: 1rem; color: #f44336;">‚ùå</div>
                    <h3 style="margin-bottom: 0.5rem; color: #f44336;">Transaction Failed</h3>
                    <p id="stkFailureMessage" style="color: #666; margin-bottom: 1rem;">Payment could not be processed</p>
                    <button onclick="closeStkPushModal()" class="submit-order-btn" style="width: 100%; margin-top: 1rem;">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Section -->
    <section id="contact" class="contact-section">
        <div class="container">
            <h2>Get In Touch üíå</h2>
            <p>Have questions? We'd love to hear from you!</p>
            <div class="contact-info">
                <div class="contact-item">
                    <div class="contact-icon">üìß</div>
                    <p>hello@slaystation.com</p>
                </div>
                <div class="contact-item">
                    <div class="contact-icon">üì±</div>
                    <p>+254 719 563 607</p>
                </div>
                <div class="contact-item">
                    <div class="contact-icon">üìç</div>
                    <p>123 Style Street, Fashion City</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Wishlist Sidebar -->
    <div class="wishlist-overlay" id="wishlistOverlay">
        <div class="wishlist-sidebar">
            <div class="wishlist-header">
                <h2>Your Wishlist üíñ</h2>
                <button class="close-wishlist" onclick="toggleWishlist()">‚úï</button>
            </div>
            <div class="wishlist-items" id="wishlistItems">
                <p class="empty-wishlist">Your wishlist is empty. Start adding your favorites! ‚ú®</p>
            </div>
        </div>
    </div>

    <!-- Quick View Modal Container -->
    <div id="quickViewModal" class="quick-view-modal">
        <!-- Quick view content will be dynamically added here -->
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="profile-modal">
        <div class="profile-modal-content">
            <div class="profile-modal-header">
                <h2>My Profile ‚ú®</h2>
                <button class="close-profile-modal" onclick="closeProfileModal()">‚úï</button>
            </div>
            
            <div class="profile-picture-section">
                <div class="profile-picture-container">
                    <div class="profile-picture-display" id="profilePictureDisplay">
                        <img id="profilePictureImg" src="" alt="Profile" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover; display: none;">
                        <span id="profilePictureIcon">üë§</span>
                    </div>
                    <button class="profile-picture-edit-btn" onclick="document.getElementById('profilePictureInput').click()">üì∑</button>
                    <input type="file" id="profilePictureInput" class="profile-picture-input" accept="image/*" onchange="handleProfilePictureChange(event)" title="Upload profile picture" aria-label="Upload profile picture">
                </div>
            </div>

            <div class="profile-info-section">
                <div class="profile-info-item">
                    <label>Full Name:</label>
                    <input type="text" id="profileName" placeholder="Enter your name">
                </div>
                <div class="profile-info-item">
                    <label>Email:</label>
                    <input type="email" id="profileEmail" placeholder="Enter your email" readonly style="background: #f5f5f5;">
                </div>
                <div class="profile-info-item">
                    <label>Phone:</label>
                    <input type="tel" id="profilePhone" placeholder="Enter your phone">
                </div>
            </div>

            <div class="profile-points-section">
                <div class="points-display">
                    <div class="points-label">Total Points Earned</div>
                    <div class="points-value" id="profilePointsValue">0</div>
                    <div class="points-label">‚≠ê Keep shopping to earn more points!</div>
                </div>
                <div class="points-history" id="pointsHistory">
                    <h3>Points History</h3>
                    <div id="pointsHistoryList">
                        <!-- Points history will be populated here -->
                    </div>
                </div>
            </div>

            <div class="profile-modal-buttons">
                <button class="cancel-profile-btn" onclick="closeProfileModal()">Cancel</button>
                <button class="save-profile-btn" onclick="saveProfile()">üíæ Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Order Tracking Link -->
    <div class="track-order-float">
        <a href="track-order.html" class="track-order-btn">
            üìç Track Your Order
        </a>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Slay Station. All rights reserved. ‚ú®</p>
            <div class="social-links">
                <a href="#">Instagram</a>
                <a href="#">Facebook</a>
                <a href="#">TikTok</a>
            </div>
        </div>
    </footer>

    <!-- Back to Top Button -->
    <button id="backToTop" class="back-to-top" onclick="scrollToTop()" title="Back to Top">
        ‚Üë
    </button>

    <script src="auth.js"></script>
    <script src="admin.js"></script>
    <script src="notifications.js"></script>
    <script src="delivery-fee-calculator.js"></script>
    <!-- M-Pesa API integration - credentials configured -->
    <script src="mpesa-api.js"></script>
    <script src="script.js"></script>
    <script>
        // Mobile menu toggle
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const navMenu = document.getElementById('navMenu');
            
            if (mobileMenuToggle && navMenu) {
                mobileMenuToggle.addEventListener('click', function() {
                    mobileMenuToggle.classList.toggle('active');
                    navMenu.classList.toggle('active');
                });
                
                // Close menu when clicking on a link
                const navLinks = navMenu.querySelectorAll('a');
                navLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        mobileMenuToggle.classList.remove('active');
                        navMenu.classList.remove('active');
                    });
                });
                
                // Close menu when clicking outside
                document.addEventListener('click', function(event) {
                    if (!mobileMenuToggle.contains(event.target) && !navMenu.contains(event.target)) {
                        mobileMenuToggle.classList.remove('active');
                        navMenu.classList.remove('active');
                    }
                });
            }
        });
        
        // Update auth UI on page load
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof updateAuthUI === 'function') {
                updateAuthUI();
            }
            
            // Load products
            if (typeof renderProducts === 'function') {
                renderProducts();
            }
            
            // Add smooth page transition class
            document.body.classList.add('page-transition');
            
            // Ensure flash sale banner close button works
            const closeBtn = document.getElementById('closeFlashSaleBtn') || document.querySelector('.close-sale');
            if (closeBtn) {
                closeBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    e.preventDefault();
                    const flashSaleBanner = document.getElementById('flashSaleBanner');
                    if (flashSaleBanner) {
                        flashSaleBanner.classList.add('hidden');
                        setTimeout(() => {
                            flashSaleBanner.style.display = 'none';
                            const hero = document.querySelector('.hero');
                            if (hero) {
                                hero.style.paddingTop = '100px';
                            }
                        }, 300);
                        localStorage.setItem('flashSaleClosed', 'true');
                    }
                });
            }

            // Back to top button functionality
            const backToTop = document.getElementById('backToTop');
            if (backToTop) {
                window.addEventListener('scroll', function() {
                    if (window.pageYOffset > 300) {
                        backToTop.style.display = 'flex';
                    } else {
                        backToTop.style.display = 'none';
                    }
                });
            }
        });

        // Scroll to top function
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Profile Modal Functions
        function showProfileModal() {
            const user = userAuth.getCurrentUser();
            if (!user) return;

            const modal = document.getElementById('profileModal');
            const profileName = document.getElementById('profileName');
            const profileEmail = document.getElementById('profileEmail');
            const profilePhone = document.getElementById('profilePhone');
            const profilePointsValue = document.getElementById('profilePointsValue');
            const profilePictureDisplay = document.getElementById('profilePictureDisplay');
            const profilePictureImg = document.getElementById('profilePictureImg');
            const profilePictureIcon = document.getElementById('profilePictureIcon');

            // Populate form
            profileName.value = user.name || '';
            profileEmail.value = user.email || '';
            profilePhone.value = user.phone || '';
            profilePointsValue.textContent = user.points || 0;

            // Set profile picture
            if (user.profilePicture) {
                profilePictureImg.src = user.profilePicture;
                profilePictureImg.style.display = 'block';
                profilePictureIcon.style.display = 'none';
            } else {
                profilePictureImg.style.display = 'none';
                profilePictureIcon.style.display = 'block';
            }

            // Load points history
            loadPointsHistory(user);

            modal.classList.add('active');
        }

        function closeProfileModal() {
            document.getElementById('profileModal').classList.remove('active');
        }

        function handleProfilePictureChange(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const profilePictureImg = document.getElementById('profilePictureImg');
                const profilePictureIcon = document.getElementById('profilePictureIcon');
                
                profilePictureImg.src = e.target.result;
                profilePictureImg.style.display = 'block';
                profilePictureIcon.style.display = 'none';
            };
            reader.readAsDataURL(file);
        }

        function saveProfile() {
            const user = userAuth.getCurrentUser();
            if (!user) return;

            const profileName = document.getElementById('profileName').value;
            const profilePhone = document.getElementById('profilePhone').value;
            const profilePictureImg = document.getElementById('profilePictureImg');
            const profilePicture = profilePictureImg.style.display === 'block' ? profilePictureImg.src : null;

            const updates = {
                name: profileName,
                phone: profilePhone,
                profilePicture: profilePicture
            };

            userAuth.updateUser(user.id, updates);
            updateAuthUI();
            closeProfileModal();
            
            // Show success message
            alert('Profile updated successfully! ‚ú®');
        }

        function loadPointsHistory(user) {
            const pointsHistoryList = document.getElementById('pointsHistoryList');
            const pointsHistory = user.pointsHistory || [];

            if (pointsHistory.length === 0) {
                pointsHistoryList.innerHTML = '<p style="text-align: center; color: #666; padding: 1rem;">No points history yet. Start shopping to earn points! üõçÔ∏è</p>';
                return;
            }

            // Sort by date (newest first)
            const sortedHistory = [...pointsHistory].sort((a, b) => new Date(b.date) - new Date(a.date));

            pointsHistoryList.innerHTML = sortedHistory.map(entry => {
                const date = new Date(entry.date).toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                return `
                    <div class="points-history-item">
                        <div>
                            <div style="font-weight: 600; color: var(--dark);">${entry.reason}</div>
                            <div style="font-size: 0.85rem; color: #666;">${date}</div>
                        </div>
                        <div class="points-amount">+${entry.amount} pts</div>
                    </div>
                `;
            }).join('');
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('profileModal');
            if (event.target === modal) {
                closeProfileModal();
            }
        });
    </script>
</body>
</html>
