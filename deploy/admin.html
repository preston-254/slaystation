<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slay Station - Admin Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        .admin-container {
            max-width: 1400px;
            margin: 100px auto 50px;
            padding: 0 20px;
        }
        
        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .admin-container {
                margin: 80px auto 20px;
                padding: 0 10px;
            }
            
            .admin-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .admin-header h1 {
                font-size: 1.5rem !important;
            }
            
            .stats-grid {
                grid-template-columns: 1fr !important;
                gap: 1rem;
            }
            
            .order-card {
                padding: 1rem !important;
            }
            
            .order-header {
                flex-direction: column;
                gap: 1rem;
            }
            
            .filters-container {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .filters-container > div {
                width: 100% !important;
            }
            
            select, input[type="text"] {
                width: 100% !important;
                font-size: 0.9rem !important;
            }
            
            button {
                font-size: 0.85rem !important;
                padding: 0.6rem 1rem !important;
            }
            
            .order-item-row {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
        
        .login-section {
            max-width: 400px;
            margin: 200px auto;
            text-align: center;
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }
        
        .login-btn {
            padding: 1rem 2rem;
            background: linear-gradient(135deg, var(--primary-pink), var(--purple));
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 1rem;
        }
        
        .login-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255, 107, 157, 0.4);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .stat-card h3 {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .stat-card .stat-value {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-pink), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .orders-list {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .order-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }
        
        .order-card:hover {
            transform: translateY(-5px);
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light-bg);
        }
        
        .order-info h3 {
            margin-bottom: 0.5rem;
            color: var(--dark);
        }
        
        .order-date, .order-customer, .order-phone, .order-address {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.3rem;
        }
        
        .order-status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .status-pending {
            background: #FFF3CD;
            color: #856404;
        }
        
        .status-confirmed {
            background: #D1ECF1;
            color: #0C5460;
        }
        
        .status-processing {
            background: #D4EDDA;
            color: #155724;
        }
        
        .status-dispatched {
            background: #CCE5FF;
            color: #004085;
        }
        
        .status-delivered {
            background: #D4EDDA;
            color: #155724;
        }
        
        .status-cancelled {
            background: #F8D7DA;
            color: #721C24;
        }
        
        .order-items {
            margin-bottom: 1.5rem;
        }
        
        .order-items h4 {
            margin-bottom: 1rem;
            color: var(--dark);
        }
        
        .order-item-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--light-bg);
        }
        
        .order-item-row.total-row {
            border-top: 2px solid var(--light-bg);
            margin-top: 0.5rem;
            padding-top: 1rem;
            font-size: 1.1rem;
        }
        
        .paid {
            color: #155724;
        }
        
        .unpaid {
            color: #721C24;
        }
        
        .order-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .status-select {
            padding: 0.5rem 1rem;
            border: 2px solid var(--light-bg);
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        .status-select:focus {
            outline: none;
            border-color: var(--primary-pink);
        }
        
        .mark-paid-btn, .delete-order-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .mark-paid-btn {
            background: linear-gradient(135deg, var(--primary-pink), var(--purple));
            color: white;
        }
        
        .delete-order-btn {
            background: var(--coral);
            color: white;
        }
        
        .mark-paid-btn:hover, .delete-order-btn:hover {
            transform: scale(1.05);
        }
        
        .admin-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .admin-header h1 {
            font-size: 3rem;
            background: linear-gradient(135deg, var(--primary-pink), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
        }
        
        .back-to-site {
            display: inline-block;
            margin-bottom: 2rem;
            color: var(--primary-pink);
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s;
        }
        
        .back-to-site:hover {
            color: var(--purple);
        }

        /* Admin Tabs */
        .admin-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 3px solid var(--light-bg);
            padding-bottom: 0;
        }

        .admin-tab {
            padding: 1rem 2rem;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            font-family: 'Poppins', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            top: 3px;
        }

        .admin-tab:hover {
            color: var(--primary-pink);
        }

        .admin-tab.active {
            color: var(--primary-pink);
            border-bottom-color: var(--primary-pink);
        }

        .admin-tab-content {
            display: none;
        }

        .admin-tab-content.active {
            display: block;
        }

        /* Product Management */
        .product-management {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .search-product-box {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .product-search-input {
            flex: 1;
            padding: 1rem;
            border: 2px solid var(--light-bg);
            border-radius: 15px;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .product-search-input:focus {
            outline: none;
            border-color: var(--primary-pink);
        }

        .add-product-btn {
            padding: 1rem 2rem;
            background: linear-gradient(135deg, var(--primary-pink), var(--purple));
            color: white;
            border: none;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .add-product-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255, 107, 157, 0.4);
        }

        .product-results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .product-edit-card {
            background: linear-gradient(135deg, #FFF8FC, #FFF0F5);
            border: 2px solid rgba(255, 107, 157, 0.2);
            border-radius: 15px;
            padding: 1.5rem;
            transition: all 0.3s;
        }

        .product-edit-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(255, 107, 157, 0.2);
            border-color: var(--primary-pink);
        }

        .product-edit-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        .product-edit-card h3 {
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .product-edit-card .product-field {
            margin-bottom: 1rem;
        }

        .product-edit-card label {
            display: block;
            margin-bottom: 0.3rem;
            color: #666;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .product-edit-card input,
        .product-edit-card textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--light-bg);
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-size: 0.9rem;
            transition: border-color 0.3s;
        }

        .product-edit-card input:focus,
        .product-edit-card textarea:focus {
            outline: none;
            border-color: var(--primary-pink);
        }

        .product-edit-card .edit-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .edit-product-btn,
        .delete-product-btn {
            flex: 1;
            padding: 0.75rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .edit-product-btn {
            background: linear-gradient(135deg, var(--primary-pink), var(--purple));
            color: white;
        }

        .delete-product-btn {
            background: var(--coral);
            color: white;
        }

        .edit-product-btn:hover,
        .delete-product-btn:hover {
            transform: scale(1.05);
        }

        /* Modal Styles */
        .product-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 5000;
            align-items: center;
            justify-content: center;
        }

        .product-modal.active {
            display: flex;
        }

        .product-modal-content {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .product-modal-content h2 {
            margin-bottom: 1.5rem;
            color: var(--dark);
        }

        .product-modal-content .form-group {
            margin-bottom: 1.5rem;
        }

        .product-modal-content label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--dark);
            font-weight: 600;
        }

        .product-modal-content input,
        .product-modal-content textarea,
        .product-modal-content select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--light-bg);
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
        }

        .product-modal-content .modal-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .product-modal-content .modal-buttons button {
            flex: 1;
            padding: 1rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .product-modal-content .save-btn {
            background: linear-gradient(135deg, var(--primary-pink), var(--purple));
            color: white;
        }

        .product-modal-content .cancel-btn {
            background: #e0e0e0;
            color: var(--dark);
        }
        
        /* Customer Communication Buttons */
        .comm-btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .call-btn {
            background: #4CAF50;
            color: white;
        }
        
        .sms-btn {
            background: #2196F3;
            color: white;
        }
        
        .whatsapp-btn {
            background: #25D366;
            color: white;
        }
        
        .proof-btn {
            background: #9C27B0;
            color: white;
        }
        
        .comm-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        /* Delivery Proof Viewer Modal */
        .delivery-proof-viewer-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 5000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .delivery-proof-viewer-modal.active {
            display: flex;
        }
        
        .delivery-proof-viewer-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        /* Dark Mode Styles */
        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
        }
        
        body.dark-mode .admin-container,
        body.dark-mode .stat-card,
        body.dark-mode .order-card,
        body.dark-mode .product-management,
        body.dark-mode .delivery-proof-viewer-content,
        body.dark-mode .login-section {
            background: #2d2d44;
            color: #e0e0e0;
        }
        
        body.dark-mode .admin-tab {
            color: #b0b0b0;
        }
        
        body.dark-mode .admin-tab.active {
            color: var(--primary-pink);
        }
        
        body.dark-mode .order-info h3,
        body.dark-mode .order-items h4 {
            color: #e0e0e0;
        }
        
        body.dark-mode .order-date,
        body.dark-mode .order-customer,
        body.dark-mode .order-phone,
        body.dark-mode .order-address {
            color: #b0b0b0;
        }
        
        body.dark-mode input,
        body.dark-mode select,
        body.dark-mode textarea {
            background: #1a1a2e;
            color: #e0e0e0;
            border-color: #444;
        }
        
        body.dark-mode .stat-card h3 {
            color: #b0b0b0;
        }
    </style>
</head>
<body>
    <!-- Login Section -->
    <div id="loginSection" class="login-section">
        <h2 style="margin-bottom: 1rem; color: var(--dark);">üîí Admin Login</h2>
        <p style="color: #666; margin-bottom: 2rem;">Enter your admin email to access dashboard</p>
        <form id="adminLoginForm" style="text-align: left;">
            <div style="margin-bottom: 1.5rem;">
                <label for="adminEmail" style="display: block; margin-bottom: 0.5rem; color: var(--dark); font-weight: 600;">Email Address:</label>
                <input 
                    type="email" 
                    id="adminEmail" 
                    placeholder="Enter admin email" 
                    required
                    style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 10px; font-family: 'Poppins', sans-serif; font-size: 1rem; transition: border-color 0.3s;"
                    onfocus="this.style.borderColor='var(--primary-pink)';"
                    onblur="this.style.borderColor='#e0e0e0';"
                >
            </div>
            <div id="loginError" style="display: none; color: #dc3545; margin-bottom: 1rem; font-size: 0.9rem; text-align: center; padding: 0.5rem; background: #f8d7da; border-radius: 5px;"></div>
            <button type="submit" class="login-btn" style="width: 100%;">Login</button>
        </form>
        <div style="margin-top: 2rem;">
            <a href="index.html" class="back-to-site">‚Üê Back to Website</a>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" style="display: none;">
        <nav class="navbar">
            <div class="nav-container">
                <div class="logo">
                    <h1>‚ú® Slay Station Admin ‚ú®</h1>
                </div>
                <div>
                    <a href="index.html" class="back-to-site" style="margin-right: 2rem;">Back to Site</a>
                    <button class="login-btn" onclick="logout()">Logout</button>
                </div>
            </div>
        </nav>

        <div class="admin-container">
            <div class="admin-header">
                <h1>Admin Dashboard üíñ</h1>
                <p>Manage orders and monitor your store</p>
            </div>

            <!-- Admin Tabs -->
            <div class="admin-tabs">
                <button class="admin-tab active" onclick="switchAdminTab('orders', this)">üì¶ Orders</button>
                <button class="admin-tab" onclick="switchAdminTab('products', this)">‚ú® Products</button>
            </div>

            <!-- Orders Tab -->
            <div id="ordersTab" class="admin-tab-content active">
                <!-- Search and Filter Section -->
                <div style="background: white; padding: 1.5rem; border-radius: 15px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1); margin-bottom: 2rem;">
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 1rem; align-items: end; flex-wrap: wrap;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--dark);">üîç Search Orders</label>
                            <input type="text" id="orderSearchInput" placeholder="Search by ID, name, phone, address..." 
                                style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 10px; font-family: 'Poppins', sans-serif;"
                                onkeyup="filterOrders()">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--dark);">üìä Status</label>
                            <select id="statusFilter" onchange="filterOrders()" 
                                style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 10px; font-family: 'Poppins', sans-serif;">
                                <option value="all">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="confirmed">Confirmed</option>
                                <option value="processing">Processing</option>
                                <option value="dispatched">Dispatched</option>
                                <option value="delivered">Delivered</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--dark);">üí≥ Payment</label>
                            <select id="paymentFilter" onchange="filterOrders()" 
                                style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 10px; font-family: 'Poppins', sans-serif;">
                                <option value="all">All Methods</option>
                                <option value="mpesa">M-Pesa</option>
                                <option value="cash">Cash on Delivery</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--dark);">üìÖ Date Range</label>
                            <select id="dateFilter" onchange="filterOrders()" 
                                style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 10px; font-family: 'Poppins', sans-serif;">
                                <option value="all">All Time</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="custom">Custom Range</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;">
                        <input type="checkbox" id="bulkSelectAll" onchange="toggleBulkSelect()" style="margin-right: 0.5rem;">
                        <label for="bulkSelectAll" style="font-weight: 600; color: var(--dark);">Select All</label>
                        <button onclick="bulkUpdateStatus()" id="bulkActionBtn" disabled style="padding: 0.5rem 1rem; background: var(--primary-pink); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; opacity: 0.5;">
                            Bulk Actions (<span id="selectedCount">0</span>)
                        </button>
                        <button onclick="clearFilters()" style="padding: 0.5rem 1rem; background: #666; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                            Clear Filters
                        </button>
                    </div>
                </div>
                
                <!-- Statistics -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Orders</h3>
                        <div class="stat-value" id="totalOrders">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Pending</h3>
                        <div class="stat-value" id="pendingOrders">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Processing</h3>
                        <div class="stat-value" id="processingOrders">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Dispatched</h3>
                        <div class="stat-value" id="dispatchedOrders">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Delivered</h3>
                        <div class="stat-value" id="deliveredOrders">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Revenue</h3>
                        <div class="stat-value" id="totalRevenue">KSH 0</div>
                    </div>
                </div>

                <!-- Orders List -->
                <div class="orders-list" id="ordersList">
                    <!-- Orders will be dynamically added here -->
                </div>
            </div>

            <!-- Products Tab -->
            <div id="productsTab" class="admin-tab-content">
                <div class="product-management">
                    <div class="product-search-section">
                        <h2 style="margin-bottom: 1.5rem; color: var(--dark);">‚ú® Product Management</h2>
                        <div class="search-product-box">
                            <input 
                                type="text" 
                                id="productSearchInput" 
                                placeholder="üîç Search product by name..." 
                                class="product-search-input"
                                onkeyup="searchProductsAdmin()"
                            >
                            <button class="add-product-btn" onclick="showAddProductModal()">‚ûï Add New Product</button>
                        </div>
                    </div>
                    <div id="productResults" class="product-results">
                        <!-- Search results will appear here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dark Mode Toggle -->
    <button id="darkModeToggle" onclick="toggleAdminDarkMode()" style="position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; border-radius: 50%; background: var(--primary-pink); color: white; border: none; font-size: 1.5rem; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 1000; transition: all 0.3s;">
        üåô
    </button>
    
    <script src="delivery-fee-calculator.js"></script>
    <script src="admin.js"></script>
    <script src="script.js"></script>
    <script src="wallets.js"></script>
    <script src="accessories.js"></script>
    <script>
        // Dark Mode Toggle
        function toggleAdminDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('adminDarkMode', isDark ? 'true' : 'false');
            
            const toggleBtn = document.getElementById('darkModeToggle');
            if (toggleBtn) {
                toggleBtn.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
            }
            
            if (typeof showNotification === 'function') {
                showNotification(isDark ? 'Dark mode enabled üåô' : 'Light mode enabled ‚òÄÔ∏è');
            } else {
                alert(isDark ? 'Dark mode enabled üåô' : 'Light mode enabled ‚òÄÔ∏è');
            }
        }
        
        // Initialize dark mode
        function initAdminDarkMode() {
            const savedMode = localStorage.getItem('adminDarkMode');
            if (savedMode === 'true') {
                document.body.classList.add('dark-mode');
                const toggleBtn = document.getElementById('darkModeToggle');
                if (toggleBtn) {
                    toggleBtn.textContent = '‚òÄÔ∏è';
                }
            }
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initAdminDarkMode();
            
            // Check for new orders every 30 seconds
            if (typeof checkForNewOrders === 'function') {
                setInterval(checkForNewOrders, 30000);
            }
        });
        
        // Notifications
        let notificationPermission = Notification.permission;
        
        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    notificationPermission = permission;
                    if (permission === 'granted' && typeof showNotification === 'function') {
                        showNotification('Notifications enabled! üîî');
                    }
                });
            }
        }
        
        function showBrowserNotification(title, options = {}) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, {
                    icon: '/favicon.ico',
                    badge: '/favicon.ico',
                    ...options
                });
            }
        }
        
        // Request notification permission on first load
        if ('Notification' in window) {
            requestNotificationPermission();
        }
    </script>
    <script>
        // Tab switching
        function switchAdminTab(tab, element) {
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.admin-tab-content').forEach(c => c.classList.remove('active'));
            
            if (element) {
                element.classList.add('active');
            }
            document.getElementById(tab + 'Tab').classList.add('active');
        }

        // Get all products from all sources
        function getAllProducts() {
            const bags = window.products || [];
            const wallets = typeof walletProducts !== 'undefined' ? walletProducts : [];
            const accessories = typeof accessoryProducts !== 'undefined' ? accessoryProducts : [];
            return [...bags, ...wallets, ...accessories];
        }

        // Search products
        function searchProductsAdmin() {
            const searchTerm = document.getElementById('productSearchInput').value.toLowerCase();
            const allProducts = getAllProducts();
            const results = allProducts.filter(p => p.name.toLowerCase().includes(searchTerm));
            
            displayProductResults(results);
        }

        // Display product results
        function displayProductResults(products) {
            const resultsDiv = document.getElementById('productResults');
            if (products.length === 0) {
                resultsDiv.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">No products found. Try a different search term or add a new product! ‚ú®</p>';
                return;
            }

            resultsDiv.innerHTML = products.map(product => `
                <div class="product-edit-card">
                    <img src="${product.image}" alt="${product.name}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22%3E%3Crect fill=%22%23FF6B9D%22 width=%22200%22 height=%22200%22/%3E%3Ctext fill=%22white%22 font-family=%22Arial%22 font-size=%2220%22 x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22%3E${product.name}%3C/text%3E%3C/svg%3E'">
                    <h3>${product.name}</h3>
                    <div class="product-field" style="background: linear-gradient(135deg, #fff5f8, #ffeef5); padding: 1.2rem; border-radius: 10px; border: 2px solid var(--primary-pink); margin-bottom: 1rem;">
                        <label style="font-weight: 700; color: var(--primary-pink); display: block; margin-bottom: 0.75rem; font-size: 1.1rem;">üí∞ Edit Price (KSH):</label>
                        <input type="number" id="price_${product.id}" value="${product.price}" min="0" onchange="checkPriceReduction(${product.id})" style="width: 100%; padding: 1rem; border: 2px solid var(--primary-pink); border-radius: 8px; font-size: 1.2rem; font-weight: 600; color: var(--dark);">
                        <small style="color: #666; font-size: 0.85rem; display: block; margin-top: 0.5rem;">Current price: KSH ${product.price.toLocaleString()}</small>
                    </div>
                    <div class="product-field" id="originalPriceField_${product.id}" style="display: ${product.originalPrice ? 'block' : 'none'};">
                        <label>Original Price (KSH) - for sale display:</label>
                        <input type="number" id="originalPrice_${product.id}" value="${product.originalPrice || ''}" min="0" placeholder="Leave empty if not on sale">
                    </div>
                    <div class="product-field">
                        <label>Product Image:</label>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <input type="file" id="imageFile_${product.id}" accept="image/*" onchange="handleImageUpload(${product.id}, this)" style="padding: 0.5rem; border: 2px solid var(--light-bg); border-radius: 8px; cursor: pointer;">
                            <small style="color: #666; font-size: 0.85rem;">Or enter image URL:</small>
                            <input type="text" id="image_${product.id}" value="${product.image}" placeholder="https://example.com/image.jpg">
                        </div>
                        <div id="imagePreview_${product.id}" style="margin-top: 0.5rem; display: ${product.image ? 'block' : 'none'};">
                            <img src="${product.image}" alt="Preview" style="max-width: 200px; max-height: 200px; border-radius: 8px; border: 2px solid var(--light-bg);" onerror="this.style.display='none'">
                        </div>
                    </div>
                    <div class="product-field">
                        <label>Video URL (optional):</label>
                        <input type="text" id="video_${product.id}" value="${product.video || ''}" placeholder="Enter video path">
                    </div>
                    <div class="product-field">
                        <label>Description:</label>
                        <textarea id="desc_${product.id}" rows="3">${product.description || ''}</textarea>
                    </div>
                    <div class="product-field" style="background: linear-gradient(135deg, #e8f5e9, #c8e6c9); padding: 1.2rem; border-radius: 10px; border: 2px solid #4CAF50; margin-bottom: 1rem;">
                        <label style="font-weight: 700; color: #2e7d32; display: block; margin-bottom: 0.75rem; font-size: 1.1rem;">üì¶ Units in Stock:</label>
                        <input type="number" id="stock_${product.id}" value="${product.stock !== undefined ? product.stock : 10}" min="0" style="width: 100%; padding: 1rem; border: 2px solid #4CAF50; border-radius: 8px; font-size: 1.2rem; font-weight: 600; color: var(--dark);">
                        <small style="color: #666; font-size: 0.85rem; display: block; margin-top: 0.5rem;">
                            ${product.stock !== undefined && product.stock === 0 ? '<span style="color: #d32f2f; font-weight: 600;">‚ö†Ô∏è SOLD OUT</span>' : product.stock !== undefined && product.stock < 5 ? '<span style="color: #f57c00; font-weight: 600;">‚ö†Ô∏è Low Stock</span>' : '‚úÖ In Stock'}
                        </small>
                    </div>
                    <div class="product-field" style="background: linear-gradient(135deg, #fff3e0, #ffe0b2); padding: 1.2rem; border-radius: 10px; border: 2px solid #ff9800; margin-bottom: 1rem;">
                        <label style="font-weight: 700; color: #e65100; display: block; margin-bottom: 0.75rem; font-size: 1.1rem;">üé® Available Colors (comma-separated):</label>
                        <input type="text" id="colors_${product.id}" value="${product.colors ? product.colors.join(', ') : 'Black, White, Pink, Brown'}" placeholder="e.g., Black, White, Pink, Brown" style="width: 100%; padding: 1rem; border: 2px solid #ff9800; border-radius: 8px; font-size: 1rem; color: var(--dark);">
                        <small style="color: #666; font-size: 0.85rem; display: block; margin-top: 0.5rem;">Separate colors with commas</small>
                    </div>
                    <div class="edit-buttons">
                        <button class="edit-product-btn" onclick="saveProduct(${product.id}, '${product.category || 'bag'}')">üíæ Save Changes</button>
                        <button class="delete-product-btn" onclick="deleteProduct(${product.id}, '${product.category || 'bag'}')">üóëÔ∏è Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // Check if price was reduced and show original price field
        function checkPriceReduction(productId) {
            const priceInput = document.getElementById(`price_${productId}`);
            const originalPriceField = document.getElementById(`originalPriceField_${productId}`);
            const originalPriceInput = document.getElementById(`originalPrice_${productId}`);
            
            if (!priceInput || !originalPriceField) return;
            
            const newPrice = parseFloat(priceInput.value);
            
            // Get current product to compare
            const allProducts = getAllProducts();
            const product = allProducts.find(p => p.id === productId);
            
            if (product && product.price && newPrice < product.price) {
                // Price was reduced - show original price field
                originalPriceField.style.display = 'block';
                if (!originalPriceInput.value) {
                    originalPriceInput.value = product.price;
                }
            } else if (newPrice && originalPriceInput && parseFloat(originalPriceInput.value) <= newPrice) {
                // Original price is not higher than new price - hide field
                originalPriceField.style.display = 'none';
                originalPriceInput.value = '';
            }
        }
        
        // Handle image file upload
        function handleImageUpload(productId, fileInput) {
            const file = fileInput.files[0];
            if (!file) return;
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file (jpg, png, gif, etc.)');
                fileInput.value = '';
                return;
            }
            
            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('Image file is too large. Please select an image smaller than 5MB.');
                fileInput.value = '';
                return;
            }
            
            // Read file as data URL
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageUrl = e.target.result;
                const imageInput = document.getElementById(`image_${productId}`);
                const preview = document.getElementById(`imagePreview_${productId}`);
                
                if (imageInput) {
                    imageInput.value = imageUrl;
                }
                
                if (preview) {
                    const img = preview.querySelector('img') || document.createElement('img');
                    img.src = imageUrl;
                    img.style.cssText = 'max-width: 200px; max-height: 200px; border-radius: 8px; border: 2px solid var(--light-bg);';
                    img.alt = 'Preview';
                    img.onerror = function() { this.style.display = 'none'; };
                    if (!preview.querySelector('img')) {
                        preview.appendChild(img);
                    }
                    preview.style.display = 'block';
                }
            };
            reader.onerror = function() {
                alert('Error reading image file. Please try again.');
                fileInput.value = '';
            };
            reader.readAsDataURL(file);
        }
        
        // Save product changes
        function saveProduct(productId, category) {
            const price = parseFloat(document.getElementById(`price_${productId}`).value);
            const originalPriceInput = document.getElementById(`originalPrice_${productId}`);
            const originalPrice = originalPriceInput && originalPriceInput.value ? parseFloat(originalPriceInput.value) : null;
            const image = document.getElementById(`image_${productId}`).value;
            const video = document.getElementById(`video_${productId}`).value;
            const description = document.getElementById(`desc_${productId}`).value;
            const stockInput = document.getElementById(`stock_${productId}`);
            const stock = stockInput ? parseInt(stockInput.value) : 10;
            const colorsInput = document.getElementById(`colors_${productId}`);
            const colors = colorsInput ? colorsInput.value.split(',').map(c => c.trim()).filter(c => c) : ['Black', 'White', 'Pink', 'Brown'];
            
            if (!price || price <= 0) {
                alert('Please enter a valid price');
                return;
            }
            
            if (!image || image.trim() === '') {
                alert('Please upload an image or enter an image URL');
                return;
            }

            // Update in appropriate product array
            if (category === 'wallet') {
                const wallets = typeof walletProducts !== 'undefined' ? walletProducts : [];
                const product = wallets.find(p => p.id === productId);
                if (product) {
                    product.price = price;
                    product.originalPrice = (originalPrice && originalPrice > price) ? originalPrice : null;
                    product.image = image;
                    product.video = video;
                    product.description = description;
                    product.stock = stock;
                    product.colors = colors;
                    localStorage.setItem('slayStationWallets', JSON.stringify(wallets));
                }
            } else if (category === 'accessory' || category === 'belt' || category === 'mp3-player') {
                const accessories = typeof accessoryProducts !== 'undefined' ? accessoryProducts : [];
                const product = accessories.find(p => p.id === productId);
                if (product) {
                    product.price = price;
                    product.originalPrice = (originalPrice && originalPrice > price) ? originalPrice : null;
                    product.image = image;
                    product.video = video;
                    product.description = description;
                    product.stock = stock;
                    product.colors = colors;
                    localStorage.setItem('slayStationAccessories', JSON.stringify(accessories));
                }
            } else {
                // Bags
                if (window.products) {
                    const product = window.products.find(p => p.id === productId);
                    if (product) {
                        product.price = price;
                        product.originalPrice = (originalPrice && originalPrice > price) ? originalPrice : null;
                        product.image = image;
                        product.video = video;
                        product.description = description;
                        product.stock = stock;
                        product.colors = colors;
                        localStorage.setItem('slayStationProducts', JSON.stringify(window.products));
                    }
                }
            }

            alert('Product updated successfully! ‚ú®');
            searchProductsAdmin(); // Refresh results
        }

        // Delete product
        function deleteProduct(productId, category) {
            if (!confirm('Are you sure you want to delete this product? This action cannot be undone.')) {
                return;
            }

            // Remove from appropriate array
            if (category === 'wallet') {
                const wallets = typeof walletProducts !== 'undefined' ? walletProducts : [];
                const index = wallets.findIndex(p => p.id === productId);
                if (index !== -1) {
                    wallets.splice(index, 1);
                    localStorage.setItem('slayStationWallets', JSON.stringify(wallets));
                }
            } else if (category === 'accessory' || category === 'belt' || category === 'mp3-player') {
                const accessories = typeof accessoryProducts !== 'undefined' ? accessoryProducts : [];
                const index = accessories.findIndex(p => p.id === productId);
                if (index !== -1) {
                    accessories.splice(index, 1);
                    localStorage.setItem('slayStationAccessories', JSON.stringify(accessories));
                }
            } else {
                if (window.products) {
                    const index = window.products.findIndex(p => p.id === productId);
                    if (index !== -1) {
                        window.products.splice(index, 1);
                        localStorage.setItem('slayStationProducts', JSON.stringify(window.products));
                    }
                }
            }

            alert('Product deleted successfully! ‚ú®');
            searchProductsAdmin(); // Refresh results
        }

        // Show add product modal
        function showAddProductModal() {
            const modal = document.getElementById('addProductModal');
            if (!modal) {
                createAddProductModal();
            }
            document.getElementById('addProductModal').classList.add('active');
        }

        // Create add product modal
        function createAddProductModal() {
            const modal = document.createElement('div');
            modal.id = 'addProductModal';
            modal.className = 'product-modal';
            modal.innerHTML = `
                <div class="product-modal-content">
                    <h2>‚ûï Add New Product</h2>
                    <form id="addProductForm">
                        <div class="form-group">
                            <label>Product Name:</label>
                            <input type="text" id="newProductName" required>
                        </div>
                        <div class="form-group">
                            <label>Category:</label>
                            <select id="newProductCategory" required>
                                <option value="bag">Bag</option>
                                <option value="wallet">Wallet</option>
                                <option value="accessory">Accessory</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Price (KSH):</label>
                            <input type="number" id="newProductPrice" min="0" required>
                        </div>
                        <div class="form-group">
                            <label>Product Image:</label>
                            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                <input type="file" id="newProductImageFile" accept="image/*" onchange="handleNewProductImageUpload(this)" style="padding: 0.5rem; border: 2px solid var(--light-bg); border-radius: 8px; cursor: pointer;">
                                <small style="color: #666; font-size: 0.85rem;">Or enter image URL:</small>
                                <input type="text" id="newProductImage" placeholder="https://example.com/image.jpg">
                            </div>
                            <div id="newProductImagePreview" style="margin-top: 0.5rem; display: none;">
                                <img id="newProductPreviewImg" src="" alt="Preview" style="max-width: 200px; max-height: 200px; border-radius: 8px; border: 2px solid var(--light-bg);">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Video URL (optional):</label>
                            <input type="text" id="newProductVideo">
                        </div>
                        <div class="form-group">
                            <label>Description:</label>
                            <textarea id="newProductDescription" rows="3" required></textarea>
                        </div>
                        <div class="form-group">
                            <label>Units in Stock:</label>
                            <input type="number" id="newProductStock" min="0" value="10" required>
                        </div>
                        <div class="form-group">
                            <label>Available Colors (comma-separated):</label>
                            <input type="text" id="newProductColors" placeholder="e.g., Black, White, Pink, Brown" value="Black, White, Pink, Brown">
                        </div>
                        <div class="modal-buttons">
                            <button type="button" class="cancel-btn" onclick="closeAddProductModal()">Cancel</button>
                            <button type="submit" class="save-btn">üíæ Add Product</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
            
            document.getElementById('addProductForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addNewProduct();
            });
        }

        // Handle new product image upload
        function handleNewProductImageUpload(fileInput) {
            const file = fileInput.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file');
                fileInput.value = '';
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                alert('Image file is too large. Please select an image smaller than 5MB.');
                fileInput.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageUrl = e.target.result;
                const imageInput = document.getElementById('newProductImage');
                const preview = document.getElementById('newProductImagePreview');
                const previewImg = document.getElementById('newProductPreviewImg');
                
                if (imageInput) {
                    imageInput.value = imageUrl;
                }
                
                if (preview && previewImg) {
                    previewImg.src = imageUrl;
                    preview.style.display = 'block';
                }
            };
            reader.onerror = function() {
                alert('Error reading image file. Please try again.');
                fileInput.value = '';
            };
            reader.readAsDataURL(file);
        }
        
        // Add new product
        function addNewProduct() {
            const name = document.getElementById('newProductName').value;
            const category = document.getElementById('newProductCategory').value;
            const price = parseFloat(document.getElementById('newProductPrice').value);
            const image = document.getElementById('newProductImage').value;
            const video = document.getElementById('newProductVideo').value;
            const description = document.getElementById('newProductDescription').value;
            const stock = parseInt(document.getElementById('newProductStock').value) || 10;
            const colorsInput = document.getElementById('newProductColors').value;
            const colors = colorsInput ? colorsInput.split(',').map(c => c.trim()).filter(c => c) : ['Black', 'White', 'Pink', 'Brown'];
            
            if (!name || !image || !price || price <= 0) {
                alert('Please fill in all required fields (name, price, image)');
                return;
            }

            const newProduct = {
                id: Date.now(),
                name: name,
                category: category,
                price: price,
                image: image,
                video: video || null,
                description: description,
                stock: stock,
                colors: colors
            };

            // Add to appropriate array
            if (category === 'wallet') {
                const wallets = typeof walletProducts !== 'undefined' ? walletProducts : [];
                wallets.push(newProduct);
                localStorage.setItem('slayStationWallets', JSON.stringify(wallets));
            } else if (category === 'accessory' || category === 'belt' || category === 'mp3-player') {
                const accessories = typeof accessoryProducts !== 'undefined' ? accessoryProducts : [];
                accessories.push(newProduct);
                localStorage.setItem('slayStationAccessories', JSON.stringify(accessories));
            } else {
                if (window.products) {
                    window.products.push(newProduct);
                    localStorage.setItem('slayStationProducts', JSON.stringify(window.products));
                }
            }

            alert('Product added successfully! ‚ú®');
            closeAddProductModal();
            searchProductsAdmin();
        }

        // Close add product modal
        function closeAddProductModal() {
            document.getElementById('addProductModal').classList.remove('active');
        }

        function logout() {
            localStorage.removeItem('slayStationAdminLoggedIn');
            localStorage.removeItem('slayStationAdminEmail');
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('adminDashboard').style.display = 'none';
        }
        
        // Handle admin authentication
        function handleAdminLogin() {
            if (window.authenticateAdmin) {
                const success = window.authenticateAdmin();
                if (success) {
                    localStorage.setItem('slayStationAdminLoggedIn', 'true');
                    const emailInput = document.getElementById('adminEmail');
                    if (emailInput) {
                        localStorage.setItem('slayStationAdminEmail', emailInput.value);
                    }
                }
            }
        }
        
        // Update form to use handleAdminLogin
        document.addEventListener('DOMContentLoaded', function() {
            const loginForm = document.querySelector('form[onsubmit]');
            if (loginForm) {
                loginForm.onsubmit = function(e) {
                    e.preventDefault();
                    handleAdminLogin();
                };
            }
            
            // Update button onclick
            const loginBtn = document.querySelector('.login-btn[type="submit"]');
            if (loginBtn && !loginBtn.onclick) {
                loginBtn.onclick = function(e) {
                    e.preventDefault();
                    handleAdminLogin();
                };
            }
        });
        
        // Auto login if already authenticated
        // Check if user is logged in via auth.js
        const currentUserJson = localStorage.getItem('slayStationCurrentUser');
        const adminEmail = 'preston.mwendwa@riarauniversity.ac.ke';
        
        if (localStorage.getItem('slayStationAdminLoggedIn') === 'true' || 
            (currentUserJson && JSON.parse(currentUserJson).email.toLowerCase() === adminEmail.toLowerCase())) {
            // User is already logged in as admin
            if (currentUserJson) {
                localStorage.setItem('slayStationAdminLoggedIn', 'true');
                const currentUser = JSON.parse(currentUserJson);
                if (currentUser.email) {
                    localStorage.setItem('slayStationAdminEmail', currentUser.email);
                }
            }
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';
            if (window.loadOrders) {
                window.loadOrders();
            }
        }
    </script>
</body>
</html>
